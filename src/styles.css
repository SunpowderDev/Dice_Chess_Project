:root {
  --l: #e5c29f;
  --d: #8b5a2b;
}

/* Dark brown brocade background for the whole game */
body {
  background: 
    repeating-linear-gradient(
      0deg,
      #2a1810 0px,
      #2a1810 2px,
      #3d2815 2px,
      #3d2815 4px
    ),
    repeating-linear-gradient(
      90deg,
      #2a1810 0px,
      #2a1810 2px,
      #3d2815 2px,
      #3d2815 4px
    ),
    radial-gradient(
      circle at 20% 30%,
      rgba(139, 90, 43, 0.3) 0%,
      transparent 50%
    ),
    radial-gradient(
      circle at 80% 70%,
      rgba(101, 67, 33, 0.3) 0%,
      transparent 50%
    ),
    linear-gradient(
      135deg,
      #1a0f08 0%,
      #2a1810 50%,
      #1a0f08 100%
    );
  background-attachment: fixed;
  min-height: 100vh;
}

.stand {
  padding: 12px;
  border-radius: 16px;
  background: linear-gradient(180deg, #3a2a18, #1a1008);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5),
    inset 0 2px 0 rgba(255, 255, 255, 0.08);
  transform: perspective(900px) rotateX(3deg);
  /* Explicitly set width to prevent layout collapse in some environments */
  display: inline-block;
}

/* Consistent dark brown background for UI elements */
.bg-consistent-dark-brown {
  background-color: #1a1008;
}
.tile {
  width: 88px;
  height: 88px;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  font-size: 28px;
  transition: background-color 0.2s ease;
}
.tL {
  background: radial-gradient(
      circle at 30% 30%,
      rgba(255, 255, 255, 0.25),
      transparent 60%
    ),
    var(--l);
  box-shadow: inset 0 3px 0 rgba(255, 255, 255, 0.25),
    inset 0 -3px 0 rgba(0, 0, 0, 0.15);
  color: #0b0b0b;
}
.tD {
  background: radial-gradient(
      circle at 30% 30%,
      rgba(255, 255, 255, 0.08),
      transparent 60%
    ),
    var(--d);
  box-shadow: inset 0 3px 0 rgba(255, 255, 255, 0.12),
    inset 0 -3px 0 rgba(0, 0, 0, 0.25);
  color: #f1f1f1;
}

/* Golden escape row for King Crossing victory condition - Palace pavement style */
.tile.escape-row.tL {
  background: 
    repeating-linear-gradient(
      45deg,
      #f5e6d3 0px,
      #f5e6d3 22px,
      #d4af37 22px,
      #d4af37 44px
    ),
    radial-gradient(
      circle at 30% 30%,
      rgba(255, 255, 255, 0.3),
      transparent 60%
    );
  box-shadow: 
    inset 0 2px 4px rgba(255, 255, 255, 0.5),
    inset 0 -2px 4px rgba(0, 0, 0, 0.1),
    0 0 15px rgba(212, 175, 55, 0.4);
  position: relative;
}

.tile.escape-row.tL::before {
  content: "";
  position: absolute;
  inset: 0;
  border: 1px solid rgba(212, 175, 55, 0.6);
  border-radius: 8px;
  z-index: 1;
  pointer-events: none;
}

.tile.escape-row.tD {
  background: 
    repeating-linear-gradient(
      45deg,
      #d4af37 0px,
      #d4af37 22px,
      #f5e6d3 22px,
      #f5e6d3 44px
    ),
    radial-gradient(
      circle at 30% 30%,
      rgba(255, 255, 255, 0.2),
      transparent 60%
    );
  box-shadow: 
    inset 0 2px 4px rgba(255, 255, 255, 0.4),
    inset 0 -2px 4px rgba(0, 0, 0, 0.2),
    0 0 15px rgba(212, 175, 55, 0.3);
  position: relative;
}

.tile.escape-row.tD::before {
  content: "";
  position: absolute;
  inset: 0;
  border: 1px solid rgba(212, 175, 55, 0.5);
  border-radius: 8px;
  z-index: 1;
  pointer-events: none;
}

.chip {
  width: 66px;
  height: 66px;
  border-radius: 9999px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 56px;
  position: relative;
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.35),
    inset 0 2px 0 rgba(255, 255, 255, 0.25);
  /* force symbol fonts to avoid colored emoji glyphs */
  font-family: "Noto Sans Symbols 2", "Segoe UI Symbol", "DejaVu Sans",
    system-ui, sans-serif;
  font-feature-settings: "liga" 0;
  text-rendering: geometricPrecision;
  transform-origin: 50% 50%;
}
.chip.pw {
  background: linear-gradient(180deg, #ffffff, #e9e9e9);
  color: #0b0b0b;
}
.chip.pb {
  font-size: 58px;
  background: linear-gradient(180deg, #4a2e1d, #2a1a0e);
  color: #ffffff;
  text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
}
.chip.pn {
  background: linear-gradient(180deg, #8b5a2b, #6a553b);
  color: #2a2015;
}
.chip.courtier-chip {
  color: #6b4423; /* Brown color for courtier glyph (black pawn symbol) */
}
.chip.stunned-piece {
  opacity: 0.85;
  filter: grayscale(0.4) brightness(0.8);
  animation: stun-shake 0.8s ease-in-out infinite;
}
.chip.shadow-piece {
  opacity: 0.7 !important;
  filter: drop-shadow(0 0 8px rgba(0, 0, 0, 0.9)) brightness(0.5) contrast(1.3) !important;
  animation: shadow-pulse 1.2s ease-in-out infinite;
}
@keyframes stun-shake {
  0%,
  100% {
    transform: translateX(0);
  }
  10%,
  30%,
  50%,
  70%,
  90% {
    transform: translateX(-1px);
  }
  20%,
  40%,
  60%,
  80% {
    transform: translateX(1px);
  }
}
@keyframes shadow-pulse {
  0%,
  100% {
    opacity: 0.5;
    filter: drop-shadow(0 0 12px rgba(0, 0, 0, 1)) brightness(0.4) contrast(1.4);
  }
  50% {
    opacity: 0.8;
    filter: drop-shadow(0 0 6px rgba(0, 0, 0, 0.8)) brightness(0.6) contrast(1.2);
  }
}

/* Obstacle chip styling - similar to pieces but with neutral brown base */
.obstacle-chip {
  width: 66px;
  height: 66px;
  border-radius: 9999px;
  background: linear-gradient(180deg, #a67c52, #8b6f47);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 60px;
  color: #2a2015;
  user-select: none;
  -webkit-user-select: none;
  text-rendering: geometricPrecision;
  /* force symbol fonts to avoid colored emoji glyphs and enable color styling */
  font-family: "Noto Sans Symbols 2", "Segoe UI Symbol", "DejaVu Sans", system-ui, sans-serif;
  font-feature-settings: "liga" 0;
}

.obstacle-chip.courtier {
  color: #6b4423; /* Brown color for courtier glyph (black pawn symbol) */
}

.ind {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 2;
}
.dot {
  width: 30px;
  height: 30px;
  border-radius: 9099px;
  background: #34d399;
  box-shadow: 0 0 22px rgba(52, 211, 153, 0.95);
}
.ring {
  position: absolute;
  width: 74px;
  height: 74px;
  border-radius: 9999px;
  box-shadow: 0 0 0 0px rgba(0, 0, 0, 0.3) inset;
}
.cap {
  box-shadow: 0 0 32px 8px rgba(34, 197, 94, 0.7),
    0 0 0 4px rgba(34, 197, 94, 0.35) inset;
  background: radial-gradient(
    circle,
    rgba(34, 197, 94, 0.22) 0 55%,
    transparent 60%
  );
}
.sup {
  box-shadow: 0 0 32px 8px rgba(59, 130, 246, 0.7),
    0 0 0 4px rgba(59, 130, 246, 0.35) inset;
  background: radial-gradient(
    circle,
    rgba(59, 130, 246, 0.24) 0 55%,
    transparent 60%
  );
}
.warn {
  box-shadow: 0 0 32px 8px rgba(249, 115, 22, 0.7),
    0 0 0 4px rgba(249, 115, 22, 0.35) inset;
  background: radial-gradient(
    circle,
    rgba(249, 115, 22, 0.22) 0 55%,
    transparent 60%
  );
}

.supB {
  position: absolute;
  top: -8px;
  left: 50%;
  transform: translateX(-50%);
  padding: 2px 6px;
  border-radius: 10px;
  font-size: 12px;
  font-weight: 800;
  color: #ecf2ff;
  background: linear-gradient(
    180deg,
    rgba(59, 130, 246, 0.95),
    rgba(37, 99, 235, 0.95)
  );
  box-shadow: 0 6px 14px rgba(37, 99, 235, 0.45);
  z-index: 5;
}

.fog {
  position: absolute;
  inset: 0;
  border-radius: 8px;
  background: linear-gradient(
      0deg,
      rgba(10, 10, 12, 0.62),
      rgba(10, 10, 12, 0.62)
    ),
    repeating-linear-gradient(
      45deg,
      rgba(255, 255, 255, 0.06) 0 6px,
      rgba(0, 0, 0, 0.06) 6px 12px
    );
  box-shadow: inset 0 0 16px rgba(0, 0, 0, 0.65);
  z-index: 100;
  pointer-events: none;
}
.forest {
  position: absolute;
  inset: 0;
  border-radius: 8px;
  background-image: url("data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2064%2064%22%3E%3Cdefs%3E%3ClinearGradient%20id%3D%22g%22%20x1%3D%220%22%20y1%3D%220%22%20x2%3D%220%22%20y2%3D%221%22%3E%3Cstop%20offset%3D%220%22%20stop-color%3D%22%231f4d2e%22%2F%3E%3Cstop%20offset%3D%221%22%20stop-color%3D%22%230d2a18%22%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Crect%20width%3D%2264%22%20height%3D%2264%22%20fill%3D%22url%28%23g%29%22%2F%3E%3Crect%20x%3D%2229%22%20y%3D%2248%22%20width%3D%226%22%20height%3D%228%22%20fill%3D%22%235D4037%22%2F%3E%3Cpath%20d%3D%22M32%2018%20L44%2038%20L20%2038%20Z%22%20fill%3D%22%232E7D32%22%2F%3E%3Cpath%20d%3D%22M32%2028%20L42%2044%20L22%2044%20Z%22%20fill%3D%22%23388E3C%22%2F%3E%3Cpath%20d%3D%22M32%2038%20L40%2050%20L24%2050%20Z%22%20fill%3D%22%2343A047%22%2F%3E%3Crect%20x%3D%2210%22%20y%3D%2252%22%20width%3D%224%22%20height%3D%226%22%20fill%3D%22%235D4037%22%2F%3E%3Cpath%20d%3D%22M12%2036%20L20%2048%20L4%2048%20Z%22%20fill%3D%22%232E7D32%22%2F%3E%3Cpath%20d%3D%22M12%2042%20L19%2052%20L5%2052%20Z%22%20fill%3D%22%23388E3C%22%2F%3E%3Crect%20x%3D%2250%22%20y%3D%2254%22%20width%3D%224%22%20height%3D%226%22%20fill%3D%22%235D4037%22%2F%3E%3Cpath%20d%3D%22M52%2040%20L60%2052%20L44%2052%20Z%22%20fill%3D%22%232E7D32%22%2F%3E%3Cpath%20d%3D%22M52%2046%20L59%2056%20L45%2056%20Z%22%20fill%3D%22%23388E3C%22%2F%3E%3C%2Fsvg%3E");
  background-size: cover;
  box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.25);
  z-index: 1;
}
.water {
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, #3b82f6, #1d4ed8);
  overflow: hidden;
  z-index: 1;
  border-radius: 8px;
} /* Added border-radius */
/* Seamless water: remove shadows/borders between adjacent water tiles */
.water + .water {
  margin-left: -1px;
} /* Adjust based on border/shadow size */
.grid > .tile:has(+ .tile > .water) > .water {
  margin-right: -1px;
}
/* Need row-based adjustments too, harder with pure CSS grid without container queries */
.water::before {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(
    circle at 70% 20%,
    rgba(255, 255, 255, 0.3),
    transparent 40%
  );
  mix-blend-mode: screen;
  opacity: 0.7;
}
.water::after {
  content: "";
  position: absolute;
  inset: -10px;
  background: repeating-linear-gradient(
    -45deg,
    rgba(255, 255, 255, 0.05) 0 5px,
    transparent 5px 10px
  );
  animation: water-move 3s linear infinite;
  opacity: 0.5;
}
@keyframes water-move {
  from {
    transform: translateX(0);
  }
  to {
    transform: translateX(-15px);
  }
}

.piece-container {
  position: relative;
  z-index: 3;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}

/* Green outline for selected pieces */
.selected-piece .chip {
  box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.8),
    0 0 20px 4px rgba(34, 197, 94, 0.6),
    0 8px 18px rgba(0, 0, 0, 0.35),
    inset 0 2px 0 rgba(255, 255, 255, 0.25);
  animation: pulse-selected 1.5s ease-in-out infinite;
}

@keyframes pulse-selected {
  0%, 100% {
    box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.8),
      0 0 20px 4px rgba(34, 197, 94, 0.6),
      0 8px 18px rgba(0, 0, 0, 0.35),
      inset 0 2px 0 rgba(255, 255, 255, 0.25);
  }
  50% {
    box-shadow: 0 0 0 4px rgba(34, 197, 94, 1),
      0 0 30px 8px rgba(34, 197, 94, 0.8),
      0 8px 18px rgba(0, 0, 0, 0.35),
      inset 0 2px 0 rgba(255, 255, 255, 0.25);
  }
}

/* Hover scaling for white pieces during market phase */
.piece-container.hover-scale {
  transform: scale(1.1);
  transition: transform 0.2s ease;
  z-index: 150;
  position: relative;
}

/* Sell button styles */
.sell-button {
  background: #dc2626;
  color: white;
  border: none;
  border-radius: 4px;
  padding: 4px 8px;
  font-size: 10px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  transition: background-color 0.2s ease;
}

.sell-button:hover {
  background: #b91c1c;
}

.equip-icon {
  position: absolute;
  font-size: 1.5rem;
  top: 0px;
  right: 0px;
  z-index: 1;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5));
  cursor: help;
}

.banner-shield-icon {
  position: absolute;
  font-size: 1.1rem;
  top: 50%;
  right: 2px;
  transform: translateY(-50%);
  z-index: 1;
  opacity: 0.8;
  filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.4));
  cursor: help;
}

/* Styling for the veteran badge */
.veteran-badge {
  position: absolute;
  font-size: 1.1rem;
  top: 2px;
  left: 2px;
  z-index: 1;
  opacity: 0.9;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5));
  cursor: help;
}

/* Styling for the terrain glyph */
.terrain-glyph {
  position: absolute;
  bottom: 2px;
  right: 2px;
  font-size: 1.2rem; /* Adjust size as needed */
  z-index: 4; /* Ensure it's above the chip */
  opacity: 0.85;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  cursor: help;
}

.supporting-piece .chip {
  filter: drop-shadow(0 0 18px #3b82f6);
}
.tile {
  position: relative;
}

.check {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 74px;
  height: 74px;
  border-radius: 9999px;
  box-shadow: 0 0 20px 8px rgba(239, 68, 68, 0.7),
    inset 0 0 0 4px rgba(239, 68, 68, 0.5);
  pointer-events: none;
}

.speech-bubble {
  position: absolute;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  padding: 8px 12px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  z-index: 300;
  width: max-content;
  max-width: 32ch;
  word-wrap: break-word;
  white-space: normal;
  animation: fade-in-out 3.5s ease-in-out forwards;
}
.speech-emphasis {
  font-weight: 900;
  font-size: 1.15em;
  display: inline-flex;
}
.speech-letter {
  display: inline-block;
  animation: letter-wave 1.2s ease-in-out infinite;
}
@keyframes letter-wave {
  0%,
  100% {
    transform: translateY(0px);
  }
  25% {
    transform: translateY(-3px);
  }
  75% {
    transform: translateY(3px);
  }
}
.speech-bubble::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
}
.white-king-bubble {
  background-color: white;
  color: black;
}
.white-king-bubble::after {
  border-top: 8px solid white;
}
.black-king-bubble {
  background-color: #222;
  color: white;
}
.black-king-bubble::after {
  border-top: 8px solid #222;
}
@keyframes fade-in-out {
  0%,
  100% {
    opacity: 0;
    transform: translate(-50%, 10px);
  }
  10%,
  90% {
    opacity: 1;
    transform: translate(-50%, 0);
  }
}
@keyframes fade-in {
  from {
    opacity: 0;
    transform: scale(0.5);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.animate-fade-in {
  animation: fade-in 0.3s ease-out both;
}
.stun-glyph {
  position: absolute;
  font-size: 2.5rem;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 5;
  opacity: 0.9;
  animation: spin 1s linear infinite;
  text-shadow: 0 0 8px rgba(96, 165, 250, 0.8);
}
.exhausted-glyph {
  position: absolute;
  font-size: 1.8rem;
  top: 2px;
  left: 2px;
  z-index: 5;
  opacity: 0.95;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5));
  animation: pulse-exhausted 2s ease-in-out infinite;
  cursor: help;
}
.bell-glyph {
  position: absolute;
  font-size: 1.6rem;
  top: 2px;
  left: 2px;
  z-index: 5;
  opacity: 0.95;
  filter: drop-shadow(0 1px 3px rgba(255, 215, 0, 0.6));
  animation: pulse-bell 2s ease-in-out infinite;
  cursor: help;
}
@keyframes spin {
  from {
    transform: translate(-50%, -50%) rotate(0deg);
  }
  to {
    transform: translate(-50%, -50%) rotate(360deg);
  }
}
@keyframes pulse-exhausted {
  0%,
  100% {
    opacity: 0.95;
    transform: scale(1);
  }
  50% {
    opacity: 0.7;
    transform: scale(0.95);
  }
}
@keyframes pulse-bell {
  0%,
  100% {
    opacity: 0.95;
    transform: scale(1);
    filter: drop-shadow(0 1px 3px rgba(255, 215, 0, 0.6));
  }
  50% {
    opacity: 1;
    transform: scale(1.05);
    filter: drop-shadow(0 2px 6px rgba(255, 215, 0, 0.9));
  }
}

@keyframes bump {
  0% {
    transform: translateY(0) scale(1);
  }
  40% {
    transform: translateY(-6px) scale(1.06);
  }
  100% {
    transform: translateY(0) scale(1);
  }
}
@keyframes checkmarkDraw {
  0% {
    opacity: 0;
    transform: scale(0) rotate(-45deg);
  }
  50% {
    opacity: 1;
    transform: scale(1.2) rotate(0deg);
  }
  100% {
    opacity: 1;
    transform: scale(1) rotate(0deg);
  }
}
.pbmp {
  animation: bump 0.4s ease-in-out both;
}
@keyframes hit {
  0% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-3px);
  }
  50% {
    transform: translateX(3px);
  }
  75% {
    transform: translateX(-1px);
  }
  100% {
    transform: translateX(0);
  }
}
.hit {
  animation: hit 0.35s ease-in-out both;
}
@keyframes destroy {
  0% {
    transform: scale(1) rotate(0);
    opacity: 1;
  }
  50% {
    transform: scale(1.1) rotate(5deg);
    opacity: 1;
  }
  100% {
    transform: scale(0.1) rotate(-15deg);
    opacity: 0;
  }
}
.destroyed {
  animation: destroy 0.4s ease-in-out forwards;
}
.badge {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  top: -28px;
  padding: 8px 12px;
  border-radius: 16px;
  font-size: 18px;
  font-weight: 900;
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  z-index: 400;
}
.ok {
  background: #a7f3d0;
  color: #0f172a;
}
.bad {
  background: #ef4444;
  color: #fff;
}
.expr {
  display: flex;
  align-items: center;
  gap: 8px;
}
.expr .term {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 2px 6px;
  border-radius: 9999px;
  background: rgba(0, 0, 0, 0.18);
  backdrop-filter: blur(2px);
  font-size: 14px;
}
.plus {
  font-weight: 900;
  opacity: 0.9;
}
.odds-container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 120;
  pointer-events: none;
  gap: 8px;
}
.supB-odds {
  padding: 2px 6px;
  border-radius: 10px;
  font-size: 12px;
  font-weight: 800;
  color: #ecf2ff;
  background: linear-gradient(
    180deg,
    rgba(59, 130, 246, 0.95),
    rgba(37, 99, 235, 0.95)
  );
  box-shadow: 0 6px 14px rgba(37, 99, 235, 0.45);
}
.pct {
  font-weight: 900;
  font-size: 16px;
  background: #000;
  border-radius: 9999px;
  padding: 4px 10px;
}
.pctG {
  color: #22c55e;
}
.pctS {
  color: #3b82f6;
}
.pct-rock {
  color: #e5c29f;
}
.market-placement-overlay {
  position: absolute;
  inset: 0;
  background-color: rgba(250, 204, 21, 0.5);
  z-index: 2;
  border-radius: 8px;
}
.market-overlay {
  animation: fadeIn 0.3s ease-in-out;
}
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
.market-equip-target .chip {
  box-shadow: 0 0 18px 6px rgba(250, 204, 21, 0.75),
    inset 0 2px 0 rgba(255, 255, 255, 0.25);
  animation: pulse-yellow 1.5s infinite;
}
@keyframes pulse-yellow {
  0% {
    box-shadow: 0 0 18px 6px rgba(250, 204, 21, 0.75),
      inset 0 2px 0 rgba(255, 255, 255, 0.25);
  }
  50% {
    box-shadow: 0 0 24px 10px rgba(250, 204, 21, 1),
      inset 0 2px 0 rgba(255, 255, 255, 0.25);
  }
  100% {
    box-shadow: 0 0 18px 6px rgba(250, 204, 21, 0.75),
      inset 0 2px 0 rgba(255, 255, 255, 0.25);
  }
}
.piece-name {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  font-size: 11px;
  background-color: rgba(0, 0, 0, 0.75);
  color: white;
  padding: 2px 4px;
  border-radius: 4px;
  text-align: center;
  font-weight: bold;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
  max-width: 78px;
  overflow: hidden;
  white-space: nowrap;
  pointer-events: none;
  z-index: 10;
}
.piece-name.preconfigured {
  background: linear-gradient(135deg, #d4af37 0%, #f4e4a6 50%, #d4af37 100%);
  color: #1a1a1a;
  font-weight: 900;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
}
.tooltip {
  background-color: rgba(0, 0, 0, 0.85);
  color: white;
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 14px;
  max-width: 260px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  will-change: transform;
  transform: translateZ(0);
  pointer-events: none !important;
  word-wrap: break-word;
}
.last-move {
  position: absolute;
  inset: 0;
  border-radius: 8px;
  background: rgba(250, 204, 21, 0.35);
  box-shadow: inset 0 0 0 3px rgba(250, 204, 21, 0.55);
  z-index: 2;
}
.moving-piece .chip {
  transform-origin: 50% 50%;
}

@media (prefers-reduced-motion: reduce) {
  .moving-piece {
    transition: none !important;
  }
}

/* Story Card Styles */
.story-card-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.story-card-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(8px);
}

.story-card {
  position: relative;
  width: 90%;
  max-width: 430px;
  background: linear-gradient(180deg, #2a2520 0%, #1a1510 100%);
  border-radius: 20px;
  padding: 32px 24px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 0 0 0 2px rgba(212, 175, 55, 0.3);
  display: flex;
  flex-direction: column;
  gap: 20px;
  color: #f5f5f5;
}

.story-card-text {
  font-size: 22px;
  line-height: 1.6;
  text-align: center;
  color: #e5e5e5;
  min-height: 60px;
  font-family: Georgia, serif;
  font-style: italic;
}

/* Medieval Framed Miniature */
.story-miniature {
  width: 100%;
  margin-bottom: 20px;
}

.miniature-frame {
  display: flex;
  gap: 16px;
  padding: 16px;
  background: linear-gradient(
    135deg,
    rgba(229, 194, 159, 0.15) 0%,
    rgba(139, 90, 43, 0.15) 100%
  );
  border: 3px solid #d4af37;
  border-radius: 12px;
  position: relative;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(212, 175, 55, 0.3), inset 0 -1px 0 rgba(0, 0, 0, 0.3);
}

/* Decorative corner elements */
.miniature-frame::before,
.miniature-frame::after {
  content: "❦";
  position: absolute;
  font-size: 20px;
  color: #d4af37;
  text-shadow: 0 0 8px rgba(212, 175, 55, 0.6);
  z-index: 1;
}

.miniature-frame::before {
  top: 8px;
  left: 8px;
}

.miniature-frame::after {
  top: 8px;
  right: 8px;
}

.miniature-character {
  flex-shrink: 0;
  display: flex;
  align-items: flex-start;
  padding-top: 4px;
}

.miniature-speech {
  flex: 1;
  position: relative;
  background: linear-gradient(
    180deg,
    rgba(245, 235, 220, 0.95) 0%,
    rgba(230, 220, 200, 0.95) 100%
  );
  border-radius: 12px;
  padding: 12px 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.4);
  border: 2px solid rgba(139, 90, 43, 0.3);
}

.speech-tail {
  position: absolute;
  left: -12px;
  top: 20px;
  width: 0;
  height: 0;
  border-top: 8px solid transparent;
  border-bottom: 8px solid transparent;
  border-right: 12px solid rgba(245, 235, 220, 0.95);
  filter: drop-shadow(-2px 0 2px rgba(0, 0, 0, 0.2));
}

.speech-content {
  font-size: 18px;
  line-height: 1.5;
  color: #2a1810;
  font-family: Georgia, "Times New Roman", serif;
  font-style: italic;
  text-shadow: 0 1px 1px rgba(255, 255, 255, 0.3);
}

.story-card-image-container {
  position: relative;
  width: 100%;
  height: 300px;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

.story-card-image {
  width: 100%;
  height: 100%;
  position: relative;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 
    0 6px 0 rgb(85, 68, 56),
    0 4px 0 rgba(85, 68, 56),
    0 2px 0 rgba(85, 68, 56),
    0 8px 20px rgba(0, 0, 0, 0.4);
}

.story-card-image-container.idle-hint {
  animation: story-card-hint-idle 3s ease-in-out infinite;
}

@keyframes story-card-hint-idle {
  0%, 100% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-12px) rotate(-0.5deg);
  }
  50% {
    transform: translateX(0);
  }
  75% {
    transform: translateX(12px) rotate(0.5deg);
  }
}

.story-card-drag-hint {
  position: absolute;
  right: 20px;
  top: 50%;
  font-size: 48px;
  opacity: 0.9;
  filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.4));
  animation: hand-drag 3s ease-in-out infinite;
  pointer-events: none;
  z-index: 10;
}

@keyframes hand-drag {
  0%, 100% {
    transform: translate(0, -50%);
  }
  25% {
    transform: translate(-25px, -50%);
  }
  50% {
    transform: translate(0, -50%);
  }
  75% {
    transform: translate(25px, -50%);
  }
}

.story-choice-overlay {
  position: absolute;
  top: 0;
  width: 50%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  background: rgba(0, 0, 0, 0.7);
}

.story-choice-overlay.left {
  left: 0;
  background: linear-gradient(to right, rgba(220, 38, 38, 0.8), transparent);
}

.story-choice-overlay.right {
  right: 0;
  background: linear-gradient(to left, rgba(34, 197, 94, 0.8), transparent);
}

/* Narrator card overlays - dark brown */
.story-choice-overlay.left.narrator {
  background: linear-gradient(to right, rgba(101, 67, 33, 0.85), transparent);
}

.story-choice-overlay.right.narrator {
  background: linear-gradient(to left, rgba(101, 67, 33, 0.85), transparent);
}

.story-choice-text {
  font-size: 20px;
  font-weight: bold;
  color: white;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
  padding: 16px;
  text-align: center;
}

.story-card-hint {
  text-align: center;
  font-size: 14px;
  color: #999;
  font-style: italic;
  margin-top: 8px;
}

.story-outcome-area {
  width: 100%;
  height: 300px;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.story-continue-arrow {
  position: absolute;
  bottom: -20px;
  right: -20px;
  min-width: 140px;
  height: 60px;
  border-radius: 30px;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  border: 3px solid #34d399;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 0 20px;
  cursor: pointer;
  box-shadow: 0 0 24px rgba(16, 185, 129, 0.4), 0 0 12px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease;
  color: white;
  z-index: 1000;
}

.story-continue-text {
  font-weight: bold;
  font-size: 18px;
  letter-spacing: 0.5px;
}

.story-continue-arrow:hover {
  transform: scale(1.05) translateX(4px);
  background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
  box-shadow: 0 0 32px rgba(16, 185, 129, 0.6), 0 0 16px rgba(0, 0, 0, 0.4);
}

.story-continue-arrow:active {
  transform: scale(1) translateX(2px);
}

/* Medieval transition overlay */
.transition-overlay {
  position: fixed;
  inset: 0;
  z-index: 3000;
  pointer-events: none;
  background: rgba(0, 0, 0, 0.6);
}

.transition-banner {
  position: absolute;
  top: 0;
  width: 50%;
  height: 100%;
  background: radial-gradient(
    ellipse at center,
    rgba(50, 35, 20, 1) 0%,
    rgba(20, 12, 6, 1) 60%,
    rgba(0, 0, 0, 1) 100%
  );
  box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.6);
  z-index: 1;
}

.transition-banner.left {
  left: 0;
  animation: banner-left 2.5s ease-in-out forwards;
}

.transition-banner.right {
  right: 0;
  animation: banner-right 2.5s ease-in-out forwards;
}

/* Start covered, hold, then slide out */
@keyframes banner-left {
  0% {
    left: 0;
  }
  70% {
    left: 0;
  }
  100% {
    left: -50%;
  }
}

@keyframes banner-right {
  0% {
    right: 0;
  }
  70% {
    right: 0;
  }
  100% {
    right: -50%;
  }
}

.transition-text {
  position: relative;
  font-family: Georgia, "Times New Roman", serif;
  font-weight: 700;
  font-size: 42px;
  color: #fef9c3;
  text-shadow: 0 4px 8px rgba(0, 0, 0, 0.6), 0 0 12px rgba(212, 175, 55, 0.8);
  opacity: 0;
  animation: trans-text 2.5s ease-in-out forwards;
  z-index: 4;
}

.transition-text::before,
.transition-text::after {
  content: "⚔️";
  position: absolute;
  font-size: 32px;
  top: 50%;
  transform: translateY(-50%);
  opacity: 0;
  animation: sword-appear 2.5s ease-in-out forwards;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
}

.transition-text::before {
  left: -60px;
  animation-delay: 0.3s;
}

.transition-text::after {
  right: -60px;
  animation-delay: 0.3s;
}

/* Difficulty Transition - Spiral Animation */
.difficulty-transition-overlay {
  position: fixed;
  inset: 0;
  z-index: 3000;
  background: #000;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  overflow: hidden;
}

.difficulty-transition-spiral {
  position: absolute;
  width: 200%;
  height: 200%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: conic-gradient(
    from 0deg at 50% 50%,
    transparent 0deg,
    transparent 60deg,
    rgba(0, 0, 0, 0.1) 90deg,
    rgba(0, 0, 0, 0.3) 120deg,
    rgba(0, 0, 0, 0.5) 150deg,
    rgba(0, 0, 0, 0.7) 180deg,
    rgba(0, 0, 0, 0.85) 210deg,
    rgba(0, 0, 0, 0.95) 240deg,
    #000 270deg,
    #000 360deg
  );
  animation: spiral-expand 2.5s ease-in-out forwards;
  border-radius: 50%;
  mask: radial-gradient(
    circle,
    transparent 0%,
    transparent 25%,
    rgba(0, 0, 0, 0.3) 35%,
    rgba(0, 0, 0, 0.7) 45%,
    #000 55%,
    #000 100%
  );
  -webkit-mask: radial-gradient(
    circle,
    transparent 0%,
    transparent 25%,
    rgba(0, 0, 0, 0.3) 35%,
    rgba(0, 0, 0, 0.7) 45%,
    #000 55%,
    #000 100%
  );
}

@keyframes spiral-expand {
  0% {
    width: 0%;
    height: 0%;
    opacity: 0;
    transform: translate(-50%, -50%) rotate(0deg);
  }
  20% {
    opacity: 1;
  }
  80% {
    width: 200%;
    height: 200%;
    opacity: 1;
    transform: translate(-50%, -50%) rotate(360deg);
  }
  100% {
    width: 200%;
    height: 200%;
    opacity: 0;
    transform: translate(-50%, -50%) rotate(540deg);
  }
}

.difficulty-transition-text-container {
  position: relative;
  z-index: 10;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 120px;
}

.difficulty-transition-line {
  font-family: Georgia, "Times New Roman", serif;
  font-weight: 700;
  font-size: 48px;
  color: #d4af37;
  text-shadow: 
    0 0 10px rgba(212, 175, 55, 0.5),
    0 0 20px rgba(212, 175, 55, 0.3),
    0 4px 8px rgba(0, 0, 0, 0.8);
  letter-spacing: 2px;
  text-align: center;
  padding: 0 40px;
  opacity: 1;
  transition: opacity 0.5s ease-out;
  white-space: nowrap;
}

.difficulty-transition-line.fading {
  opacity: 0;
}

.difficulty-transition-line-1 {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.difficulty-transition-line-2 {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

@keyframes trans-text {
  0% {
    opacity: 0;
    transform: scale(0.8) translateY(-10px);
  }
  15% {
    opacity: 1;
    transform: scale(1.1) translateY(0);
  }
  20% {
    transform: scale(0.95) translateY(0);
  }
  25% {
    transform: scale(1.05) translateY(0);
  }
  30% {
    transform: scale(1) translateY(0);
  }
  65% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
  100% {
    opacity: 0;
    transform: scale(0.98) translateY(0);
  }
}

@keyframes sword-appear {
  0% {
    opacity: 0;
    transform: translateY(-50%) scale(0.5) rotate(-20deg);
  }
  15% {
    opacity: 1;
    transform: translateY(-50%) scale(1) rotate(0deg);
  }
  65% {
    opacity: 1;
    transform: translateY(-50%) scale(1) rotate(0deg);
  }
  100% {
    opacity: 0;
    transform: translateY(-50%) scale(0.8) rotate(10deg);
  }
}

/* Battle-themed seal - heraldic shield design with corner spikes */
.transition-seal {
  position: absolute;
  top: 52%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 280px;
  height: 280px;
  border-radius: 50%;
  /* Rich dark background with subtle radial glow */
  background: 
    radial-gradient(
      circle at 50% 50%,
      rgba(139, 90, 43, 0.25) 0%,
      rgba(60, 40, 20, 0.6) 40%,
      rgba(20, 12, 6, 0.95) 70%,
      rgba(10, 8, 5, 1) 100%
    );
  /* Enhanced golden border with inner glow */
  border: 5px solid rgba(217, 119, 6, 0.85);
  border-radius: 50%;
  /* Stronger shadow for depth */
  box-shadow: 
    0 0 0 2px rgba(0, 0, 0, 0.8),
    0 0 30px rgba(217, 119, 6, 0.4),
    inset 0 0 40px rgba(0, 0, 0, 0.5),
    0 25px 50px -12px rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 1;
  animation: trans-seal 2.5s ease-in-out forwards;
  z-index: 3;
  /* No overflow hidden - allows swords glyphs to extend outside */
  /* Decorative elements are constrained by their own sizing */
}

/* Inner golden ring for heraldic elegance */
.transition-seal::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 240px;
  height: 240px;
  border-radius: 50%;
  border: 2px solid rgba(234, 179, 8, 0.3);
  z-index: 1;
  box-shadow: 
    inset 0 0 20px rgba(234, 179, 8, 0.2),
    0 0 15px rgba(217, 119, 6, 0.3);
}

/* Radial corner accents - elegant heraldic points */
.transition-seal::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;
  z-index: 1;
  background-image: 
    /* Top accent */
    radial-gradient(
      circle at 50% 20%,
      transparent 10px,
      rgba(234, 179, 8, 0.6) 10px,
      rgba(234, 179, 8, 0.8) 12px,
      transparent 14px
    ),
    /* Bottom accent */
    radial-gradient(
      circle at 50% 80%,
      transparent 10px,
      rgba(234, 179, 8, 0.6) 10px,
      rgba(234, 179, 8, 0.8) 12px,
      transparent 14px
    );
  background-size: 100% 100%;
  background-position: center;
  background-repeat: no-repeat;
  filter: drop-shadow(0 0 6px rgba(234, 179, 8, 0.4));
}

@keyframes trans-seal {
  0% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(0.9);
  }
  30% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  70% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.98);
  }
}

/* Story Card Outcome Animations */
@keyframes outcomeAppear {
  0% {
    opacity: 0;
    transform: translateY(-20px) scale(0.9);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes outcomePulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
}

@keyframes glyphSpin {
  0% {
    transform: rotate(0deg) scale(0.5);
    opacity: 0;
  }
  50% {
    transform: rotate(180deg) scale(1.2);
  }
  100% {
    transform: rotate(360deg) scale(1);
    opacity: 1;
  }
}

/* Pulsing green glow animation for START BATTLE button */
@keyframes pulse-glow {
  0%, 100% {
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.5), 0 0 40px rgba(16, 185, 129, 0.3);
  }
  50% {
    box-shadow: 0 0 30px rgba(16, 185, 129, 0.8), 0 0 60px rgba(16, 185, 129, 0.5), 0 0 80px rgba(16, 185, 129, 0.3);
  }
}

/* Pulsing blue glow animation for COMPLETE DEPLOYMENT button */
@keyframes pulse-glow-blue {
  0%, 100% {
    box-shadow: 0 0 20px rgba(37, 99, 235, 0.5), 0 0 40px rgba(37, 99, 235, 0.3);
  }
  50% {
    box-shadow: 0 0 30px rgba(37, 99, 235, 0.8), 0 0 60px rgba(37, 99, 235, 0.5), 0 0 80px rgba(37, 99, 235, 0.3);
  }
}

/* Tutorial Popup Styles */
.tutorial-popup {
  position: absolute;
  background: linear-gradient(180deg, #2a2520 0%, #1a1510 100%);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 
    0 20px 60px rgba(0, 0, 0, 0.8),
    0 0 0 3px rgba(212, 175, 55, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  min-width: 320px;
  max-width: 400px;
  z-index: 100;
  animation: tutorial-appear 0.3s ease-out;
  will-change: transform, opacity;
}

/* Mechanic tutorial variant - centered with banner */
.tutorial-popup-mechanic {
  position: absolute;
  max-width: 420px;
  padding: 0;
  overflow: hidden;
  margin: 0;
}

.tutorial-popup-banner {
  width: 100%;
  height: auto;
  overflow: hidden;
  position: relative;
}

.tutorial-popup-banner img {
  width: 100%;
  height: auto;
  object-fit: contain;
  display: block;
}

.tutorial-popup-mechanic .tutorial-popup-content {
  padding: 24px;
}

@keyframes tutorial-appear {
  0% {
    opacity: 0;
    transform: scale(0.95);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes tutorial-appear-positioned {
  0% {
    opacity: 0;
    transform: translateX(-50%) scale(0.95);
  }
  100% {
    opacity: 1;
    transform: translateX(-50%) scale(1);
  }
}

.tutorial-popup-content {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.tutorial-popup-title {
  font-size: 20px;
  font-weight: 700;
  color: #fbbf24;
  text-align: center;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
  font-family: Georgia, serif;
  line-height: 1.3;
}

.tutorial-popup-subtitle {
  font-size: 16px;
  color: #e5e5e5;
  text-align: center;
  line-height: 1.5;
  margin-bottom: 8px;
}

.tutorial-popup-buttons {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 8px;
}

.tutorial-popup-btn {
  padding: 10px 20px;
  border-radius: 10px;
  font-weight: 700;
  font-size: 14px;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.tutorial-popup-btn-cancel {
  background: linear-gradient(180deg, #92400e 0%, #78350f 100%);
  color: #fef3c7;
  border: 1px solid rgba(217, 119, 6, 0.4);
}

.tutorial-popup-btn-cancel:hover {
  background: linear-gradient(180deg, #b45309 0%, #92400e 100%);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
  transform: translateY(-1px);
}

.tutorial-popup-btn-confirm {
  background: linear-gradient(180deg, #10b981 0%, #059669 100%);
  color: white;
  border: 1px solid rgba(16, 185, 129, 0.4);
}

.tutorial-popup-btn-confirm:hover {
  background: linear-gradient(180deg, #34d399 0%, #10b981 100%);
  box-shadow: 0 6px 12px rgba(16, 185, 129, 0.4), 0 0 20px rgba(16, 185, 129, 0.2);
  transform: translateY(-1px);
}

.tutorial-popup-btn:active {
  transform: translateY(0);
}